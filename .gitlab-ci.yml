
# Official OpenJDK Java image. Look for the different tagged releases at
# https://hub.docker.com/_/openjdk/ . A Java image is not required
# but an image with a JVM speeds up the build a bit.
stages:
  - compilation
  - frontend-tests
  - backend-tests
  - code-coverage

build:
  image: hseeberger/scala-sbt:eclipse-temurin-17.0.1_1.6.1_2.13.8
  stage: compilation
  script:
    - sbt compile

frontend-tests:
  image: hseeberger/scala-sbt:eclipse-temurin-17.0.1_1.6.1_2.13.8
  stage: frontend-tests
  script:
    - sbt "testOnly ParserTests"
    - sbt "testOnly SemanticTests"
  needs:
    - build

backend-tests:
  image: hseeberger/scala-sbt:eclipse-temurin-17.0.1_1.6.1_2.13.8
  stage: backend-tests
  script:
    - apt-get install gcc-arm-linux-gnueabi qemu qemu-user -y
    - sbt "testOnly BackendTests"
  needs:
    - build

code-coverage:
  image: hseeberger/scala-sbt:eclipse-temurin-17.0.1_1.6.1_2.13.8
  stage: code-coverage
  script:
    - sbt coverage test coverageReport
  needs:
    - frontend-tests
    - backend-tests
  artifacts: 
    reports:
      cobertura:
        - target/scala-2.13/coverage-report/cobertura.xml
    paths:
      - target/scala-2.13/scoverage-report
